name: 'GAWG Notify action'
description: 'This action sends a notification containing workflow info to the desired channel.'
author: Álvaro García Pizarro
branding:
  icon: 'inbox'
  color: 'gray-dark'

inputs:
  messaging_app:
    type: string
    description: 'Messaging app to send the notification to.'
    required: true
  artifact_name:
    type: string
    description: 'Name of the artifact generated by the build.'
    required: true

runs:
  using: "composite"
  steps:
    - name: Generate Workflow Summary Report
      shell: bash
      run: |
        echo ""
        echo "====================================== WORKFLOW SUMMARY ======================================="
        echo "## Workflow information" >> $GITHUB_STEP_SUMMARY
        echo "## Workflow information" >> summary.txt
        echo "🔧 Technology: ${{ inputs.technology }} | Docker enabled: ${{ inputs.docker }} | Self-hosted runners: ${{ inputs.self-hosted-runner }} | Deployment type: ${{ inputs.deployment }} | Artifact name: ${{ inputs.artifact_name }}."
        echo "🔧 Technology: ${{ inputs.technology }} | Docker enabled: ${{ inputs.docker }} | Self-hosted runners: ${{ inputs.self-hosted-runner }} | Deployment type: ${{ inputs.deployment }} | Artifact name: ${{ inputs.artifact_name }}." >> summary.txt
        echo "🔧 Technology: ${{ inputs.technology }} | Docker enabled: ${{ inputs.docker }} | Self-hosted runners: ${{ inputs.self-hosted-runner }} | Deployment type: ${{ inputs.deployment }} | Artifact name: ${{ inputs.artifact_name }}." >> $GITHUB_STEP_SUMMARY
        echo "👤 Workflow (${{ github.workflow }}) triggered on ${{ github.event_name }} by ${{ github.actor }} on ${{ github.repository }} repository (${{ github.ref }} branch)."
        echo "👤 Workflow (${{ github.workflow }}) triggered on ${{ github.event_name }} by ${{ github.actor }} on ${{ github.repository }} repository (${{ github.ref }} branch)." >> summary.txt
        echo "👤 Workflow (${{ github.workflow }}) triggered on ${{ github.event_name }} by ${{ github.actor }} on ${{ github.repository }} repository (${{ github.ref }} branch)." >> $GITHUB_STEP_SUMMARY
        echo "🆔 Workflow run ID: ${{ github.run_id }}"
        echo "🆔 Workflow run ID: ${{ github.run_id }}" >> summary.txt
        echo "🆔 Workflow run ID: ${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY
        echo "🕒 Execution time: $(date)"
        echo "🕒 Execution time: $(date)" >> summary.txt
        echo "🕒 Execution time: $(date)" >> $GITHUB_STEP_SUMMARY
        echo "🔗 Run URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
        echo "🔗 Run URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" >> summary.txt
        echo "🔗 Run URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" >> $GITHUB_STEP_SUMMARY
        echo "==============================================================================================="
        
    - name: Test
      shell: bash
      run: |
        cat summary.txt

    - name: No notification needed
      if: ${{ inputs.messaging_app == 'none' }}
      shell: bash
      run: |
        echo "No notification needed. Skipping this job."  

    - name: Email notification
      if: ${{ inputs.messaging_app == 'email' }}
      shell: bash
      run: |
        echo "Sending email notification to the team."

    - name: Slack notification
      if: ${{ inputs.messaging_app == 'slack' }}
      shell: bash
      run: |
        echo "Sending Slack notification to the team."

    - name: Microsoft Teams notification
      if: ${{ inputs.messaging_app == 'msteams' }}
      shell: bash
      run: |
        echo "Sending Microsoft Teams notification to the team."